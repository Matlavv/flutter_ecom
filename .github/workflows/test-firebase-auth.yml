name: ðŸ§ª Test Firebase Authentication

on:
    workflow_dispatch:

env:
    PROJECT_ID: 'flutter-app-ecom'

jobs:
    test-auth:
        name: ðŸ” Test Firebase Auth
        runs-on: ubuntu-latest

        steps:
            - name: ðŸ“¥ Checkout code
              uses: actions/checkout@v4

            - name: ðŸ”§ Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: '20'

            - name: ðŸ”¥ Setup Firebase CLI
              run: npm install -g firebase-tools

            - name: ðŸ” Test Firebase Authentication
              env:
                  GOOGLE_APPLICATION_CREDENTIALS: ${{ runner.temp }}/firebase-service-account.json
              run: |
                  if [ -z "${{ secrets.FIREBASE_SERVICE_ACCOUNT }}" ]; then
                    echo "âŒ ERREUR: Le secret FIREBASE_SERVICE_ACCOUNT n'est pas configurÃ©"
                    echo "ðŸ“‹ Veuillez suivre les instructions dans setup-github-secrets.md"
                    exit 1
                  fi

                  echo "${{ secrets.FIREBASE_SERVICE_ACCOUNT }}" > $GOOGLE_APPLICATION_CREDENTIALS

                  echo "ðŸ” Test de l'authentification Firebase..."
                  firebase projects:list --project $PROJECT_ID

                  echo "âœ… Authentification Firebase rÃ©ussie!"
                  echo "ðŸŽ¯ Projet: $PROJECT_ID"

                  echo "ðŸ” Test des permissions Hosting..."
                  firebase hosting:sites:list --project $PROJECT_ID

                  echo "âœ… Permissions Firebase Hosting confirmÃ©es!"

            - name: ðŸ“Š Summary
              run: |
                  echo "## âœ… Test d'authentification Firebase rÃ©ussi!" >> $GITHUB_STEP_SUMMARY
                  echo "" >> $GITHUB_STEP_SUMMARY
                  echo "### ðŸŽ¯ Projet testÃ©:" >> $GITHUB_STEP_SUMMARY
                  echo "$PROJECT_ID" >> $GITHUB_STEP_SUMMARY
                  echo "" >> $GITHUB_STEP_SUMMARY
                  echo "### âœ… Permissions vÃ©rifiÃ©es:" >> $GITHUB_STEP_SUMMARY
                  echo "- Firebase Projects: âœ…" >> $GITHUB_STEP_SUMMARY
                  echo "- Firebase Hosting: âœ…" >> $GITHUB_STEP_SUMMARY

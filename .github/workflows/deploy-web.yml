name: Deploy Web to Vercel

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]
    workflow_dispatch:

jobs:
    deploy-web:
        runs-on: ubuntu-latest

        steps:
            - name: ğŸ“¥ Checkout code
              uses: actions/checkout@v4

            - name: ğŸ¦ Setup Flutter
              uses: subosito/flutter-action@v2
              with:
                  flutter-version: '3.27.0'
                  channel: 'stable'

            - name: ğŸ“¦ Install dependencies
              run: flutter pub get

            - name: ğŸ§ª Run tests
              run: flutter test

            - name: ğŸ” Analyze code
              run: flutter analyze

            - name: ğŸŒ Build web
              run: flutter build web --release --web-renderer canvaskit

            - name: ğŸš€ Deploy to Vercel
              uses: amondnet/vercel-action@v25
              with:
                  vercel-token: ${{ secrets.VERCEL_TOKEN }}
                  vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
                  vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
                  working-directory: ./
                  vercel-args: '--prod'

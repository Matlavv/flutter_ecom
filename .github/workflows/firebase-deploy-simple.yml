name: ðŸ”¥ Firebase Deploy Simple

on:
    workflow_dispatch:
    push:
        branches: [main]

env:
    FLUTTER_VERSION: '3.24.5'
    PROJECT_ID: 'flutter-app-ecom'

jobs:
    deploy:
        name: ðŸš€ Deploy to Firebase
        runs-on: ubuntu-latest
        environment: production

        steps:
            - name: ðŸ“¥ Checkout code
              uses: actions/checkout@v4

            - name: ðŸ¦ Setup Flutter
              uses: subosito/flutter-action@v2
              with:
                  flutter-version: ${{ env.FLUTTER_VERSION }}
                  channel: 'stable'
                  cache: true

            - name: ðŸ“¦ Get dependencies
              run: flutter pub get

            - name: ðŸ§ª Run tests
              run: flutter test

            - name: ðŸ”¨ Build web
              run: flutter build web --release

            - name: ðŸ”§ Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: '20'

            - name: ðŸ”¥ Setup Firebase CLI
              run: npm install -g firebase-tools

            - name: ðŸš€ Deploy to Firebase Hosting
              env:
                  GOOGLE_APPLICATION_CREDENTIALS: ${{ runner.temp }}/firebase-service-account.json
              run: |
                  echo "${{ secrets.FIREBASE_SERVICE_ACCOUNT }}" > $GOOGLE_APPLICATION_CREDENTIALS

                  echo "ðŸš€ DÃ©ploiement sur Firebase Hosting..."
                  firebase deploy --only hosting --project $PROJECT_ID

                  echo "âœ… DÃ©ploiement terminÃ©!"
                  echo "ðŸŒ URL: https://$PROJECT_ID.web.app"

            - name: ðŸ“Š Summary
              run: |
                  echo "## ðŸŽ‰ DÃ©ploiement Firebase rÃ©ussi!" >> $GITHUB_STEP_SUMMARY
                  echo "" >> $GITHUB_STEP_SUMMARY
                  echo "### ðŸ”— URL de production:" >> $GITHUB_STEP_SUMMARY
                  echo "https://$PROJECT_ID.web.app" >> $GITHUB_STEP_SUMMARY
